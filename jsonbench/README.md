# JSON encoding libraries comparison benchmark

Encoding efficiency of 6 libraries was compared on same autogenerated payload which should look like a typical output of the relayer.

Key results:
- [Jettison](https://github.com/wI2L/jettison) and [Jsoniter](https://github.com/json-iterator/go) are winners speed-wise (4.5x faster than std). Reason of that is obviously their support of custom marshal-to-writer functions.
- [Jettison](https://github.com/wI2L/jettison) also performs surprisingly small amount of allocations.
- [Jsoniter](https://github.com/json-iterator/go) however has Encoder API (marshal entire output to stream), which could be useful for direct output to http, [Jettison](https://github.com/wI2L/jettison) doesn't have this feature.
- [Sonic](https://github.com/bytedance/sonic) implementation looks very promising, but it doesn't have custom marshal-to-writer functions support ([see issue](https://github.com/bytedance/sonic/issues/356)), hence low results.

```
GOARCH=amd64 go test -v -bench=. -benchtime=10s

BenchmarkStdMarshal
BenchmarkStdMarshal-10                	   10000	   1148144 ns/op	  452311 B/op	    5151 allocs/op
BenchmarkStdEncode
BenchmarkStdEncode-10                 	   10000	   1070507 ns/op	  264602 B/op	    5101 allocs/op
BenchmarkStdEncodeNoEscape
BenchmarkStdEncodeNoEscape-10         	   10000	   1011243 ns/op	  265156 B/op	    5101 allocs/op
BenchmarkJettison
BenchmarkJettison-10                  	   45945	    261601 ns/op	  202803 B/op	      51 allocs/op
BenchmarkJettisonFast
BenchmarkJettisonFast-10              	   44750	    267428 ns/op	  206878 B/op	     101 allocs/op
BenchmarkJettisonSuperFast
BenchmarkJettisonSuperFast-10         	   44466	    267939 ns/op	  206622 B/op	     101 allocs/op
BenchmarkSegmentioMarshal
BenchmarkSegmentioMarshal-10          	   10000	   1000743 ns/op	  506299 B/op	    7569 allocs/op
BenchmarkSegmentioEncode
BenchmarkSegmentioEncode-10           	   13005	    921329 ns/op	  318438 B/op	    7522 allocs/op
BenchmarkSegmentioEncodeFast
BenchmarkSegmentioEncodeFast-10       	   19628	    611685 ns/op	  320127 B/op	    7516 allocs/op
BenchmarkJsoniterDefaultMarshal
BenchmarkJsoniterDefaultMarshal-10    	   44994	    267244 ns/op	  205822 B/op	     164 allocs/op
BenchmarkJsoniterDefaultEncode
BenchmarkJsoniterDefaultEncode-10     	   31527	    373693 ns/op	  690113 B/op	     438 allocs/op
BenchmarkJsoniterCompatMarshal
BenchmarkJsoniterCompatMarshal-10     	   46700	    256317 ns/op	  206846 B/op	     164 allocs/op
BenchmarkJsoniterCompatEncode
BenchmarkJsoniterCompatEncode-10      	   31764	    376090 ns/op	  690244 B/op	     438 allocs/op
BenchmarkJsoniterFastestMarshal
BenchmarkJsoniterFastestMarshal-10    	   46820	    256937 ns/op	  207550 B/op	     164 allocs/op
BenchmarkJsoniterFastestEncode
BenchmarkJsoniterFastestEncode-10     	   31587	    376954 ns/op	  690156 B/op	     438 allocs/op
BenchmarkGoccyMarshal
BenchmarkGoccyMarshal-10              	   16392	    727990 ns/op	  462124 B/op	    5146 allocs/op
BenchmarkGoccyMarshalNoEscape
BenchmarkGoccyMarshalNoEscape-10      	   16456	    729060 ns/op	  461979 B/op	    5147 allocs/op
BenchmarkGoccyMarshalFast
BenchmarkGoccyMarshalFast-10          	   18043	    663204 ns/op	  464805 B/op	    5149 allocs/op
BenchmarkGoccyEncode
BenchmarkGoccyEncode-10               	   18648	    645528 ns/op	  273059 B/op	    5101 allocs/op
BenchmarkGoccyEncodeFast
BenchmarkGoccyEncodeFast-10           	   20725	    577785 ns/op	  273604 B/op	    5101 allocs/op
BenchmarkSonicMarhsalDefault
BenchmarkSonicMarhsalDefault-10       	   21566	    554541 ns/op	  563160 B/op	    5299 allocs/op
BenchmarkSonicMarhsalStd
BenchmarkSonicMarhsalStd-10           	   10000	   1084696 ns/op	  673924 B/op	    5301 allocs/op
BenchmarkSonicMarhsalFastest
BenchmarkSonicMarhsalFastest-10       	   21726	    551593 ns/op	  563772 B/op	    5299 allocs/op
BenchmarkSonicEncodeDefault
BenchmarkSonicEncodeDefault-10        	   18974	    628637 ns/op	  715223 B/op	    5430 allocs/op
BenchmarkSonicEncodeStd
BenchmarkSonicEncodeStd-10            	   10000	   1050143 ns/op	  635125 B/op	    5454 allocs/op
BenchmarkSonicEncodeFastest
BenchmarkSonicEncodeFastest-10        	   19293	    620775 ns/op	  706253 B/op	    5424 allocs/op
```